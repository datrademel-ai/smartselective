<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SmartSelective ‚Äî Test in Progress</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&family=Fraunces:wght@600;700;800&display=swap" rel="stylesheet">
<style>
/* ============================================================
   CSS VARIABLES & RESET
   ============================================================ */
:root {
  --bg-deep: #0b0f1a;
  --bg-primary: #0f1629;
  --bg-panel: #151d33;
  --bg-panel-alt: #1a2340;
  --bg-hover: #1e2a4a;
  --bg-selected: rgba(59,130,246,0.12);
  --accent: #3b82f6;
  --accent-hover: #2563eb;
  --accent-glow: rgba(59,130,246,0.25);
  --green: #10b981;
  --green-bg: rgba(16,185,129,0.1);
  --red: #ef4444;
  --red-bg: rgba(239,68,68,0.08);
  --orange: #f59e0b;
  --orange-bg: rgba(245,158,11,0.1);
  --purple: #8b5cf6;
  --cyan: #06b6d4;
  --text-primary: #f0f4f8;
  --text-secondary: #94a3b8;
  --text-muted: #5a6a80;
  --border: rgba(255,255,255,0.06);
  --border-active: rgba(59,130,246,0.4);
  --shadow-lg: 0 8px 32px rgba(0,0,0,0.4);
  --radius-sm: 8px;
  --radius-md: 12px;
  --radius-lg: 16px;
}

* { margin:0; padding:0; box-sizing:border-box; }

html, body {
  height: 100%;
  overflow: hidden;
  font-family: 'DM Sans', sans-serif;
  background: var(--bg-deep);
  color: var(--text-primary);
}

/* ============================================================
   TOP BAR ‚Äî fixed, full-width
   ============================================================ */
.topbar {
  height: 56px;
  background: var(--bg-primary);
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 24px;
  position: relative;
  z-index: 50;
  flex-shrink: 0;
}

.topbar-left {
  display: flex;
  align-items: center;
  gap: 16px;
}

.logo-sm {
  width: 32px; height: 32px;
  background: linear-gradient(135deg, var(--accent), var(--purple));
  border-radius: 8px;
  display: flex; align-items: center; justify-content: center;
  font-family: 'Fraunces', serif;
  font-weight: 800; font-size: 16px; color: #fff;
}

.test-title {
  font-weight: 600; font-size: 15px; color: var(--text-secondary);
}

.test-title strong { color: var(--text-primary); font-weight: 700; }

.topbar-center {
  position: absolute;
  left: 50%; transform: translateX(-50%);
  display: flex; align-items: center; gap: 20px;
}

/* Timer */
.timer-display {
  display: flex; align-items: center; gap: 10px;
  background: var(--bg-panel);
  padding: 8px 20px;
  border-radius: 28px;
  border: 1px solid var(--border);
  font-family: 'JetBrains Mono', monospace;
  font-size: 18px; font-weight: 600;
  letter-spacing: 1px;
  min-width: 140px;
  justify-content: center;
  transition: all 0.3s ease;
}

.timer-display.warning {
  border-color: var(--orange);
  color: var(--orange);
  animation: timerPulse 1s ease-in-out infinite;
}

.timer-display.danger {
  border-color: var(--red);
  color: var(--red);
  animation: timerPulse 0.5s ease-in-out infinite;
}

@keyframes timerPulse {
  0%,100% { box-shadow: none; }
  50% { box-shadow: 0 0 16px var(--red-bg); }
}

.timer-icon {
  width: 18px; height: 18px;
  opacity: 0.7;
}

/* Progress in topbar */
.progress-info {
  font-size: 13px; color: var(--text-muted);
  display: flex; align-items: center; gap: 6px;
}

.progress-info strong {
  color: var(--text-primary);
  font-family: 'JetBrains Mono', monospace;
}

.topbar-right {
  display: flex; align-items: center; gap: 10px;
}

.topbar-btn {
  padding: 8px 16px;
  border-radius: var(--radius-sm);
  font-family: 'DM Sans', sans-serif;
  font-weight: 600; font-size: 13px;
  border: 1px solid var(--border);
  background: transparent;
  color: var(--text-secondary);
  cursor: pointer;
  transition: all 0.2s ease;
  display: flex; align-items: center; gap: 6px;
}

.topbar-btn:hover {
  background: var(--bg-hover);
  color: var(--text-primary);
  border-color: rgba(255,255,255,0.12);
}

.topbar-btn.btn-submit {
  background: var(--accent);
  color: #fff;
  border-color: var(--accent);
}

.topbar-btn.btn-submit:hover {
  background: var(--accent-hover);
  box-shadow: 0 0 20px var(--accent-glow);
}

/* ============================================================
   MAIN LAYOUT ‚Äî left panel (questions) + right panel (passage)
   ============================================================ */
.exam-layout {
  display: flex;
  height: calc(100vh - 56px);
  overflow: hidden;
}

/* LEFT PANEL ‚Äî Passage / Reading Material */
.left-panel {
  width: 48%;
  min-width: 380px;
  max-width: 680px;
  display: flex;
  flex-direction: column;
  background: var(--bg-primary);
  border-right: 1px solid var(--border);
}

.left-panel.collapsed {
  width: 0;
  min-width: 0;
  max-width: 0;
  overflow: hidden;
  border: none;
}

.left-panel.full-width {
  width: 0;
  min-width: 0;
  max-width: 0;
  overflow: hidden;
  border: none;
}

/* RIGHT PANEL ‚Äî Question + Options */
.right-panel {
  flex: 1;
  min-width: 0;
  display: flex;
  flex-direction: column;
}

/* Right panel full width when passage panel hidden */
.right-panel.full-width {
  flex: 1;
}

/* Resize handle */
.resize-handle {
  width: 6px;
  cursor: col-resize;
  background: transparent;
  position: relative;
  flex-shrink: 0;
  transition: background 0.2s;
  z-index: 10;
}

.resize-handle:hover,
.resize-handle.active {
  background: var(--accent);
}

.resize-handle::after {
  content: '';
  position: absolute;
  top: 50%; left: 50%;
  transform: translate(-50%, -50%);
  width: 4px; height: 40px;
  border-radius: 2px;
  background: var(--text-muted);
  opacity: 0;
  transition: opacity 0.2s;
}

.resize-handle:hover::after { opacity: 0.5; }

/* ============================================================
   LEFT PANEL CONTENT
   ============================================================ */
.question-section {
  flex: 1;
  overflow-y: auto;
  padding: 40px 48px;
  scrollbar-width: thin;
  scrollbar-color: rgba(255,255,255,0.08) transparent;
}

.question-section::-webkit-scrollbar { width: 6px; }
.question-section::-webkit-scrollbar-track { background: transparent; }
.question-section::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.08); border-radius: 3px; }

/* Question header */
.q-top-bar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 28px;
}

.q-number-badge {
  display: flex;
  align-items: center;
  gap: 12px;
}

.q-num-circle {
  width: 48px; height: 48px;
  background: linear-gradient(135deg, var(--accent), var(--purple));
  border-radius: 14px;
  display: flex; align-items: center; justify-content: center;
  font-family: 'JetBrains Mono', monospace;
  font-weight: 700; font-size: 18px; color: #fff;
  box-shadow: 0 4px 16px var(--accent-glow);
}

.q-info {
  display: flex; flex-direction: column; gap: 2px;
}

.q-subject-label {
  font-size: 12px; color: var(--text-muted);
  text-transform: uppercase; letter-spacing: 1px;
}

.q-diff-label {
  font-size: 12px; font-weight: 600;
  padding: 2px 8px;
  border-radius: 4px;
  display: inline-flex;
  width: fit-content;
}

.diff-easy { background: var(--green-bg); color: var(--green); }
.diff-medium { background: var(--orange-bg); color: var(--orange); }
.diff-hard { background: var(--red-bg); color: var(--red); }

.q-actions {
  display: flex; gap: 8px;
}

.q-action-btn {
  width: 40px; height: 40px;
  border-radius: var(--radius-sm);
  border: 1px solid var(--border);
  background: transparent;
  color: var(--text-muted);
  cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  transition: all 0.2s ease;
}

.q-action-btn:hover {
  background: var(--bg-hover);
  color: var(--text-primary);
}

.q-action-btn.flagged {
  background: var(--orange-bg);
  border-color: var(--orange);
  color: var(--orange);
}

/* Question text */
.question-text {
  font-size: 17px;
  line-height: 1.8;
  color: var(--text-primary);
  margin-bottom: 32px;
  font-weight: 500;
}

/* Options */
.options-list {
  display: flex;
  flex-direction: column;
  gap: 12px;
  margin-bottom: 40px;
}

.option-item {
  display: flex;
  align-items: flex-start;
  gap: 16px;
  padding: 18px 22px;
  border-radius: var(--radius-md);
  border: 2px solid var(--border);
  cursor: pointer;
  transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
}

.option-item::before {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(135deg, var(--accent-glow), transparent);
  opacity: 0;
  transition: opacity 0.3s ease;
}

.option-item:hover {
  border-color: rgba(255,255,255,0.15);
  background: var(--bg-hover);
}

.option-item.selected {
  border-color: var(--accent);
  background: var(--bg-selected);
}

.option-item.selected::before { opacity: 1; }

.option-item.selected .option-letter {
  background: var(--accent);
  color: #fff;
  border-color: var(--accent);
}

.option-letter {
  width: 36px; height: 36px;
  border-radius: 10px;
  border: 2px solid var(--border);
  display: flex; align-items: center; justify-content: center;
  font-family: 'JetBrains Mono', monospace;
  font-weight: 700; font-size: 14px;
  color: var(--text-muted);
  flex-shrink: 0;
  transition: all 0.25s ease;
  position: relative;
  z-index: 1;
}

.option-text {
  font-size: 15px;
  line-height: 1.6;
  color: var(--text-secondary);
  padding-top: 6px;
  position: relative;
  z-index: 1;
  transition: color 0.2s ease;
}

.option-item.selected .option-text { color: var(--text-primary); }
.option-item:hover .option-text { color: var(--text-primary); }

/* Keyboard shortcut hint */
.option-shortcut {
  position: absolute;
  right: 18px; top: 50%;
  transform: translateY(-50%);
  font-family: 'JetBrains Mono', monospace;
  font-size: 11px;
  color: var(--text-muted);
  opacity: 0;
  transition: opacity 0.2s;
  background: var(--bg-panel);
  padding: 2px 8px;
  border-radius: 4px;
  border: 1px solid var(--border);
  z-index: 1;
}

.option-item:hover .option-shortcut { opacity: 0.6; }

/* ============================================================
   BOTTOM NAV ‚Äî Previous / Next + Question map
   ============================================================ */
.bottom-nav {
  flex-shrink: 0;
  padding: 16px 32px;
  border-top: 1px solid var(--border);
  background: var(--bg-primary);
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.nav-btn {
  padding: 12px 28px;
  border-radius: var(--radius-sm);
  font-family: 'DM Sans', sans-serif;
  font-weight: 600; font-size: 14px;
  border: none;
  cursor: pointer;
  display: flex; align-items: center; gap: 8px;
  transition: all 0.2s ease;
}

.nav-btn-prev {
  background: var(--bg-panel);
  color: var(--text-secondary);
  border: 1px solid var(--border);
}

.nav-btn-prev:hover { background: var(--bg-hover); color: var(--text-primary); }

.nav-btn-next {
  background: var(--accent);
  color: #fff;
}

.nav-btn-next:hover {
  background: var(--accent-hover);
  box-shadow: 0 0 20px var(--accent-glow);
}

/* Question map (mini) - REMOVED, using simple progress info */
.nav-progress-info {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 4px;
}

.nav-progress-text {
  font-size: 14px;
  color: var(--text-secondary);
}

.nav-progress-text strong {
  color: var(--text-primary);
  font-family: 'JetBrains Mono', monospace;
}

/* ============================================================
   PAUSE OVERLAY
   ============================================================ */
.pause-overlay {
  position: fixed;
  inset: 0;
  background: rgba(11, 15, 26, 0.95);
  backdrop-filter: blur(20px);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 300;
}

.pause-overlay.show {
  display: flex;
}

.pause-content {
  text-align: center;
  animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
  from { opacity: 0; transform: scale(0.95); }
  to { opacity: 1; transform: scale(1); }
}

.pause-icon {
  font-size: 64px;
  margin-bottom: 24px;
}

.pause-content h2 {
  font-family: 'Fraunces', serif;
  font-size: 32px;
  font-weight: 700;
  margin-bottom: 12px;
}

.pause-content p {
  font-size: 16px;
  color: var(--text-secondary);
  margin-bottom: 32px;
}

.pause-timer {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 4px;
  margin-bottom: 32px;
}

.pause-timer span:first-child {
  font-family: 'JetBrains Mono', monospace;
  font-size: 48px;
  font-weight: 700;
  color: var(--accent);
}

.pause-timer-label {
  font-size: 14px;
  color: var(--text-muted);
}

.pause-resume-btn {
  display: inline-flex;
  align-items: center;
  gap: 10px;
  padding: 16px 40px;
  border-radius: var(--radius-md);
  background: var(--accent);
  color: #fff;
  font-family: 'DM Sans', sans-serif;
  font-size: 16px;
  font-weight: 600;
  border: none;
  cursor: pointer;
  transition: all 0.2s;
}

.pause-resume-btn:hover {
  background: var(--accent-hover);
  box-shadow: 0 0 30px var(--accent-glow);
  transform: translateY(-2px);
}

/* ============================================================
   RIGHT PANEL ‚Äî Passage
   ============================================================ */
.passage-header {
  padding: 16px 28px;
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  justify-content: space-between;
  flex-shrink: 0;
}

.passage-title {
  font-weight: 600; font-size: 14px;
  color: var(--text-secondary);
  display: flex; align-items: center; gap: 8px;
}

.passage-title-icon {
  width: 28px; height: 28px;
  background: rgba(6,182,212,0.1);
  border-radius: 6px;
  display: flex; align-items: center; justify-content: center;
}

.passage-controls {
  display: flex; gap: 6px;
}

.passage-ctrl-btn {
  width: 32px; height: 32px;
  border-radius: 6px;
  border: 1px solid var(--border);
  background: transparent;
  color: var(--text-muted);
  cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  transition: all 0.2s;
  font-size: 14px;
}

.passage-ctrl-btn:hover { background: var(--bg-hover); color: var(--text-primary); }

.passage-body {
  flex: 1;
  overflow-y: auto;
  padding: 32px 36px;
  scrollbar-width: thin;
  scrollbar-color: rgba(255,255,255,0.06) transparent;
}

.passage-body::-webkit-scrollbar { width: 5px; }
.passage-body::-webkit-scrollbar-track { background: transparent; }
.passage-body::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.06); border-radius: 3px; }

.passage-content {
  font-size: 15px;
  line-height: 2;
  color: var(--text-secondary);
  transition: font-size 0.3s ease;
}

.passage-content p {
  margin-bottom: 20px;
  text-indent: 2em;
}

.passage-content p:first-child { text-indent: 0; }

.passage-content .highlight-line {
  background: rgba(245,158,11,0.08);
  border-left: 3px solid var(--orange);
  padding: 4px 12px;
  margin: 8px -12px;
  border-radius: 0 6px 6px 0;
}

.passage-label {
  font-family: 'JetBrains Mono', monospace;
  font-size: 11px;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 1.5px;
  margin-bottom: 20px;
  padding-bottom: 12px;
  border-bottom: 1px solid var(--border);
}

.no-passage {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100%;
  color: var(--text-muted);
  text-align: center;
  gap: 12px;
  padding: 40px;
}

.no-passage svg { opacity: 0.3; }
.no-passage p { font-size: 14px; }

/* Toggle passage button for left panel */
.toggle-passage-btn {
  display: none;
}

/* ============================================================
   MODALS ‚Äî Question Navigator + Submit Confirmation
   ============================================================ */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.7);
  backdrop-filter: blur(8px);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 200;
}

.modal-overlay.show { display: flex; }

.modal-box {
  background: var(--bg-panel);
  border: 1px solid var(--border);
  border-radius: var(--radius-lg);
  padding: 36px;
  max-width: 560px;
  width: 90%;
  box-shadow: var(--shadow-lg);
  animation: modalIn 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
}

@keyframes modalIn {
  from { opacity: 0; transform: scale(0.9) translateY(20px); }
  to { opacity: 1; transform: scale(1) translateY(0); }
}

.modal-title {
  font-family: 'Fraunces', serif;
  font-size: 22px; font-weight: 700;
  margin-bottom: 8px;
}

.modal-sub {
  font-size: 14px; color: var(--text-muted);
  margin-bottom: 24px;
}

/* Navigator grid in modal */
.nav-grid {
  display: grid;
  grid-template-columns: repeat(6, 1fr);
  gap: 8px;
  margin-bottom: 28px;
}

.nav-cell {
  aspect-ratio: 1;
  border-radius: var(--radius-sm);
  border: 1px solid var(--border);
  display: flex; align-items: center; justify-content: center;
  font-family: 'JetBrains Mono', monospace;
  font-size: 14px; font-weight: 600;
  color: var(--text-muted);
  cursor: pointer;
  transition: all 0.15s ease;
  position: relative;
}

.nav-cell:hover { background: var(--bg-hover); color: var(--text-primary); }
.nav-cell.current { background: var(--accent); color: #fff; border-color: var(--accent); }
.nav-cell.answered { background: var(--green-bg); color: var(--green); border-color: rgba(16,185,129,0.3); }
.nav-cell.flagged-cell { border-color: var(--orange); }
.nav-cell.flagged-cell::after {
  content: 'üö©';
  position: absolute;
  top: -4px; right: -4px;
  font-size: 10px;
}

.nav-legend {
  display: flex; gap: 20px;
  margin-bottom: 24px;
}

.nav-legend-item {
  display: flex; align-items: center; gap: 8px;
  font-size: 13px; color: var(--text-secondary);
}

.legend-swatch {
  width: 14px; height: 14px;
  border-radius: 4px;
  border: 1px solid var(--border);
}

.modal-actions {
  display: flex; gap: 12px;
  justify-content: flex-end;
}

.modal-btn {
  padding: 10px 24px;
  border-radius: var(--radius-sm);
  font-family: 'DM Sans', sans-serif;
  font-weight: 600; font-size: 14px;
  cursor: pointer;
  border: none;
  transition: all 0.2s;
}

.modal-btn-cancel {
  background: var(--bg-panel-alt);
  color: var(--text-secondary);
  border: 1px solid var(--border);
}

.modal-btn-cancel:hover { background: var(--bg-hover); color: var(--text-primary); }

.modal-btn-confirm {
  background: var(--accent);
  color: #fff;
}

.modal-btn-confirm:hover { background: var(--accent-hover); }

.modal-btn-submit {
  background: var(--green);
  color: #fff;
}

.modal-btn-submit:hover { background: #059669; }

/* Submit stats */
.submit-stats {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 12px;
  margin-bottom: 24px;
}

.submit-stat {
  text-align: center;
  padding: 16px;
  background: rgba(255,255,255,0.02);
  border-radius: var(--radius-sm);
  border: 1px solid var(--border);
}

.submit-stat-value {
  font-family: 'JetBrains Mono', monospace;
  font-size: 28px; font-weight: 700;
}

.submit-stat-label {
  font-size: 12px; color: var(--text-muted);
  margin-top: 4px;
}

/* ============================================================
   PROGRESS BAR (below topbar)
   ============================================================ */
.progress-bar-wrapper {
  height: 3px;
  background: rgba(255,255,255,0.03);
  flex-shrink: 0;
}

.progress-bar-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--accent), var(--cyan));
  transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
  border-radius: 0 2px 2px 0;
}

/* ============================================================
   RESPONSIVE
   ============================================================ */
@media (max-width: 900px) {
  .right-panel { display: none; }
  .resize-handle { display: none; }
  .toggle-passage-btn { display: flex; }
  .question-section { padding: 24px; }
}

/* ============================================================
   SCROLLBAR GLOBAL
   ============================================================ */
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.08); border-radius: 3px; }
</style>
</head>
<body>

<!-- ============================================================
     TOP BAR
     ============================================================ -->
<header class="topbar">
  <div class="topbar-left">
    <div class="logo-sm">S</div>
    <div class="test-title"><strong>Week 1</strong> ‚Äî Full Test</div>
  </div>

  <div class="topbar-center">
    <div class="timer-display" id="timerDisplay">
      <svg class="timer-icon" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
      <span id="timerText">30:00</span>
    </div>
    <div class="progress-info">
      <span id="answeredCount"><strong>0</strong></span> / <span id="totalQCount">30</span> answered
    </div>
  </div>

  <div class="topbar-right">
    <button class="topbar-btn" id="pauseBtn" onclick="togglePause()">
      <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><rect x="6" y="4" width="4" height="16" rx="1"/><rect x="14" y="4" width="4" height="16" rx="1"/></svg>
      Pause
    </button>
    <button class="topbar-btn btn-submit" onclick="openSubmitModal()">
      Submit Test ‚úì
    </button>
  </div>
</header>

<!-- Progress bar -->
<div class="progress-bar-wrapper">
  <div class="progress-bar-fill" id="progressBar" style="width:0%"></div>
</div>

<!-- ============================================================
     MAIN EXAM LAYOUT
     ============================================================ -->
<div class="exam-layout">

  <!-- LEFT PANEL: Passage (Reading Material) -->
  <div class="left-panel" id="leftPanel">
    <div class="passage-header">
      <div class="passage-title">
        <div class="passage-title-icon">
          <svg width="16" height="16" fill="none" stroke="var(--cyan)" stroke-width="2" viewBox="0 0 24 24"><path d="M2 3h6a4 4 0 014 4v14a3 3 0 00-3-3H2z"/><path d="M22 3h-6a4 4 0 00-4 4v14a3 3 0 013-3h7z"/></svg>
        </div>
        <span id="passageLabel">Reading Passage</span>
      </div>
      <div class="passage-controls">
        <button class="passage-ctrl-btn" onclick="changePassageFontSize(-1)" title="Decrease font">A‚àí</button>
        <button class="passage-ctrl-btn" onclick="changePassageFontSize(1)" title="Increase font">A+</button>
      </div>
    </div>
    <div class="passage-body">
      <div class="passage-content" id="passageContent">
        <div class="no-passage" id="noPassage">
          <svg width="48" height="48" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/></svg>
          <p>No passage for this question</p>
          <p style="font-size:12px">Passage will appear here when relevant</p>
        </div>
      </div>
    </div>
  </div>

  <!-- RESIZE HANDLE -->
  <div class="resize-handle" id="resizeHandle"></div>

  <!-- RIGHT PANEL: Question + Options -->
  <div class="right-panel" id="rightPanel">
    <div class="question-section" id="questionSection">

      <!-- Question top bar -->
      <div class="q-top-bar">
        <div class="q-number-badge">
          <div class="q-num-circle" id="qNumCircle">1</div>
          <div class="q-info">
            <span class="q-subject-label" id="qSubject">READING</span>
            <span class="q-diff-label diff-medium" id="qDifficulty">Medium</span>
          </div>
        </div>
        <div class="q-actions">
          <button class="q-action-btn" id="flagBtn" onclick="toggleFlag()" title="Flag for review">
            <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/><line x1="4" y1="22" x2="4" y2="15"/></svg>
          </button>
          <button class="q-action-btn" onclick="clearAnswer()" title="Clear selection">
            <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/></svg>
          </button>
        </div>
      </div>

      <!-- Question text -->
      <div class="question-text" id="questionText">Loading question...</div>

      <!-- Options -->
      <div class="options-list" id="optionsList"></div>

    </div>

    <!-- Bottom navigation (simplified - no question map) -->
    <div class="bottom-nav">
      <button class="nav-btn nav-btn-prev" id="prevBtn" onclick="prevQuestion()">
        <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M15 18l-6-6 6-6"/></svg>
        Previous
      </button>

      <div class="nav-progress-info">
        <span class="nav-progress-text">Question <strong id="currentQNum">1</strong> of <strong id="totalQNum">30</strong></span>
      </div>

      <button class="nav-btn nav-btn-next" id="nextBtn" onclick="nextQuestion()">
        Next
        <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M9 18l6-6-6-6"/></svg>
      </button>
    </div>
  </div>

</div>

<!-- ============================================================
     PAUSE OVERLAY
     ============================================================ -->
<div class="pause-overlay" id="pauseOverlay">
  <div class="pause-content">
    <div class="pause-icon">‚è∏Ô∏è</div>
    <h2>Test Paused</h2>
    <p>Your timer has been stopped. Click Resume to continue.</p>
    <div class="pause-timer">
      <span id="pausedTimeDisplay">30:00</span>
      <span class="pause-timer-label">remaining</span>
    </div>
    <button class="pause-resume-btn" onclick="togglePause()">
      <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
      Resume Test
    </button>
  </div>
</div>

<!-- ============================================================
     SUBMIT MODAL
     ============================================================ -->
<div class="modal-overlay" id="submitModal">
  <div class="modal-box">
    <div class="modal-title">Submit Test?</div>
    <div class="modal-sub">Review your progress before submitting</div>
    <div class="submit-stats">
      <div class="submit-stat">
        <div class="submit-stat-value" style="color:var(--green)" id="submitAnswered">0</div>
        <div class="submit-stat-label">Answered</div>
      </div>
      <div class="submit-stat">
        <div class="submit-stat-value" style="color:var(--orange)" id="submitUnanswered">0</div>
        <div class="submit-stat-label">Unanswered</div>
      </div>
      <div class="submit-stat">
        <div class="submit-stat-value" style="color:var(--orange)" id="submitFlagged">0</div>
        <div class="submit-stat-label">Flagged</div>
      </div>
    </div>
    <p style="font-size:14px;color:var(--text-muted);margin-bottom:20px" id="submitWarning"></p>
    <div class="modal-actions">
      <button class="modal-btn modal-btn-cancel" onclick="closeSubmitModal()">Continue Test</button>
      <button class="modal-btn modal-btn-submit" onclick="submitTest()">Submit Test</button>
    </div>
  </div>
</div>


<script>
// ============================================================
//  TEST DATA ‚Äî 30 questions (4 subjects)
//  In production, load from API/localStorage
// ============================================================
const TEST_DATA = {
  testName: "Week 1 - Full Test",
  timeLimit: 1800,
  subjects: [
    { name: "Reading", color: "#3b82f6", icon: "üìñ" },
    { name: "Mathematics", color: "#10b981", icon: "üî¢" },
    { name: "Thinking Skills", color: "#8b5cf6", icon: "üß©" },
    { name: "Writing", color: "#f59e0b", icon: "‚úçÔ∏è" }
  ],
  questions: [
    // === READING (Q1-8) ===
    {
      id:1, subject:"Reading", difficulty:"medium",
      passage: `<div class="passage-label">Passage A ‚Äî The Library of Alexandria</div>
<p>The ancient library of Alexandria, once the largest in the known world, housed scrolls containing the accumulated knowledge of Greek, Egyptian, and Persian civilisations. Scholars travelled thousands of miles to study within its walls, making it the intellectual heart of the ancient world.</p>
<p>At its peak, the library was believed to contain over 400,000 scrolls, covering subjects from astronomy to philosophy, mathematics to medicine. The head librarian held one of the most prestigious positions in the ancient world, responsible for cataloguing and preserving humanity's collective wisdom.</p>
<p>Its eventual destruction ‚Äî whether by fire, neglect, or conquest ‚Äî remains one of history's greatest losses. The knowledge contained within those walls may have advanced human civilisation by centuries had it survived.</p>`,
      question: "According to the passage, what made the Library of Alexandria the 'intellectual heart' of the ancient world?",
      options: ["It was the oldest library ever built","Scholars from far away came to study there","It contained only Greek manuscripts","It was located in the capital city"],
      correctAnswer: 1,
      explanation: "The passage states 'scholars travelled thousands of miles to study within its walls', directly linking distant scholars to its status as the intellectual heart.",
      steps: ["Identify the key phrase: 'intellectual heart of the ancient world'","Find what caused this ‚Äî scholars travelling there","Option B directly matches this reasoning","Other options are unsupported by the text"]
    },
    {
      id:2, subject:"Reading", difficulty:"hard",
      passage: `<div class="passage-label">Passage B ‚Äî Chameleon Colour Change</div>
<p>Despite the widespread belief that chameleons change colour primarily for camouflage, recent research reveals that their colour shifts are mainly driven by social signalling and temperature regulation. A dominant male, for instance, will display vibrant hues to assert territory, while a submissive individual turns darker to avoid confrontation.</p>
<p>Scientists at the University of Geneva discovered that chameleons achieve these colour changes through a lattice of nanocrystals beneath their skin. By adjusting the spacing between these crystals, the chameleon can selectively reflect different wavelengths of light, producing a stunning spectrum of colours.</p>
<p>This mechanism is far more sophisticated than simple pigment changes seen in other animals. It represents a form of structural colour ‚Äî the same principle that gives butterfly wings their iridescent shimmer.</p>`,
      question: "What is the primary purpose of colour change in chameleons, according to the passage?",
      options: ["To hide from predators","To attract mates during breeding season","For social communication and temperature control","To blend in with flowers and leaves"],
      correctAnswer: 2,
      explanation: "The passage explicitly states colour changes are 'mainly driven by social signalling and temperature regulation', correcting the common camouflage assumption.",
      steps: ["Notice 'Despite' ‚Äî the passage corrects a misconception","True reasons: social signalling + temperature regulation","Option C combines both purposes","Option A is the misconception being corrected"]
    },
    {
      id:3, subject:"Reading", difficulty:"easy", passage:null,
      question: "Which word is closest in meaning to 'accumulated' as used in Passage A?",
      options: ["Scattered","Gathered","Ancient","Written"],
      correctAnswer: 1,
      explanation: "'Accumulated' means gathered over time. The library collected knowledge from multiple civilisations over many years.",
      steps: ["'Accumulated' = collected over time","Context: knowledge from multiple civilisations","'Gathered' is the closest synonym"]
    },
    {
      id:4, subject:"Reading", difficulty:"medium", passage:null,
      question: "What tone does the author convey about the destruction of the library in Passage A?",
      options: ["Indifference","Deep regret","Anger","Curiosity"],
      correctAnswer: 1,
      explanation: "'One of history's greatest losses' and 'may have advanced human civilisation by centuries' convey deep regret about what was lost.",
      steps: ["Key phrases: 'greatest losses', 'advanced civilisation by centuries'","These express loss and mourning","Deep regret fits this sombre, reflective tone","Anger would use more aggressive language"]
    },
    {
      id:5, subject:"Reading", difficulty:"hard",
      passage: `<div class="passage-label">Passage C ‚Äî Octopus Intelligence</div>
<p>Marine biologists have discovered that octopuses exhibit remarkably sophisticated problem-solving abilities. In laboratory experiments, octopuses have been observed unscrewing jars from the inside, navigating complex mazes, and even using coconut shells as portable shelters ‚Äî behaviour previously thought unique to vertebrates.</p>
<p>Unlike most intelligent animals, the octopus has a highly decentralised nervous system. Two-thirds of its neurons reside in its arms, which can independently taste, touch, and make basic decisions even when severed from the body. This distributed intelligence allows for parallel processing of information across multiple limbs simultaneously.</p>
<p>Perhaps most remarkably, octopuses have demonstrated the capacity for play ‚Äî a behaviour associated with higher cognitive function. In laboratory settings, they have been observed repeatedly squirting jets of water at floating objects, apparently for entertainment rather than any survival purpose.</p>`,
      question: "The mention of coconut shell usage primarily serves to:",
      options: ["Show that octopuses live near tropical beaches","Demonstrate tool use previously thought exclusive to vertebrates","Prove octopuses are smarter than all vertebrates","Explain how octopuses protect themselves"],
      correctAnswer: 1,
      explanation: "The coconut shell example illustrates tool use, connected to 'behaviour previously thought unique to vertebrates'. It challenges assumptions about invertebrate capabilities.",
      steps: ["Coconut shells listed among sophisticated behaviours","Connected to: 'behaviour previously thought unique to vertebrates'","This = tool use that was unexpected in invertebrates","Option C overstates ('smarter than all')"]
    },
    {
      id:6, subject:"Reading", difficulty:"easy", passage:null,
      question: "In Passage C, what does the word 'sophisticated' most likely mean?",
      options: ["Simple","Advanced and complex","Underwater","Quick"],
      correctAnswer: 1,
      explanation: "Context clues (unscrewing jars, navigating mazes, using tools) all indicate complex, advanced behaviour.",
      steps: ["Context: solving problems, navigating mazes, using tools","All are complex behaviours","'Sophisticated' = advanced and complex"]
    },
    {
      id:7, subject:"Reading", difficulty:"medium", passage:null,
      question: "Why does the author include laboratory experiments as evidence in Passage C?",
      options: ["To make the passage seem more scientific","To provide verifiable, controlled evidence of intelligence","To show that octopuses are kept in labs","To criticise animal testing"],
      correctAnswer: 1,
      explanation: "Lab experiments provide controlled, repeatable evidence. This strengthens the scientific claims about octopus intelligence.",
      steps: ["Lab experiments = controlled conditions","This makes claims verifiable and credible","Option B describes this function accurately"]
    },
    {
      id:8, subject:"Reading", difficulty:"hard", passage:null,
      question: "Which statement best summarises the author's central argument across Passage C?",
      options: ["Octopuses are the most intelligent sea creatures","Octopuses show cognitive abilities that challenge assumptions about invertebrate intelligence","Lab testing is the best method to study animals","Vertebrates and invertebrates have equal intelligence"],
      correctAnswer: 1,
      explanation: "The passage builds a case that octopus intelligence challenges what we assumed about invertebrates, without claiming they equal or surpass vertebrates.",
      steps: ["Main thread: surprising cognitive abilities in octopuses","Key qualifier: challenges assumptions, doesn't equalise","Option B captures this nuance correctly","Option D overstates the argument"]
    },
    // === MATHEMATICS (Q9-16) ===
    {
      id:9, subject:"Mathematics", difficulty:"easy", passage:null,
      question: "What is 3/4 + 2/3?",
      options: ["5/7","17/12","1 5/12","5/12"],
      correctAnswer: 2,
      explanation: "Find LCD (12): 3/4 = 9/12, 2/3 = 8/12. Sum = 17/12 = 1 5/12.",
      steps: ["LCD of 4 and 3 = 12","3/4 = 9/12","2/3 = 8/12","9/12 + 8/12 = 17/12 = 1 5/12"]
    },
    {
      id:10, subject:"Mathematics", difficulty:"medium", passage:null,
      question: "A rectangular garden has a perimeter of 36 metres. If the length is twice the width, what is the area?",
      options: ["72 m¬≤","54 m¬≤","36 m¬≤","48 m¬≤"],
      correctAnswer: 0,
      explanation: "Let w = width, l = 2w. Perimeter: 2(w + 2w) = 36 ‚Üí 6w = 36 ‚Üí w = 6. Area = 6 √ó 12 = 72 m¬≤.",
      steps: ["Let width = w, length = 2w","2(w + 2w) = 36 ‚Üí 6w = 36 ‚Üí w = 6","Length = 12m","Area = 6 √ó 12 = 72 m¬≤"]
    },
    {
      id:11, subject:"Mathematics", difficulty:"hard", passage:null,
      question: "A shop offers 20% off, then an additional 15% off the discounted price. What is the total percentage discount?",
      options: ["35%","32%","30%","28%"],
      correctAnswer: 1,
      explanation: "Successive discounts multiply: 0.80 √ó 0.85 = 0.68 = 68%. Discount = 32%.",
      steps: ["After 20% off: pay 80%","After 15% off that: 80% √ó 0.85 = 68%","Total discount = 100% - 68% = 32%","Common mistake: 20+15 = 35% (wrong!)"]
    },
    {
      id:12, subject:"Mathematics", difficulty:"medium", passage:null,
      question: "If 5x ‚àí 3 = 2x + 9, what is the value of x?",
      options: ["2","3","4","6"],
      correctAnswer: 2,
      explanation: "5x ‚àí 2x = 9 + 3 ‚Üí 3x = 12 ‚Üí x = 4.",
      steps: ["5x ‚àí 3 = 2x + 9","3x = 12","x = 4"]
    },
    {
      id:13, subject:"Mathematics", difficulty:"hard", passage:null,
      question: "A train travels 120 km at 60 km/h, then 180 km at 90 km/h. What is the average speed for the entire journey?",
      options: ["72 km/h","75 km/h","80 km/h","78 km/h"],
      correctAnswer: 1,
      explanation: "Total distance = 300 km. Total time = 2 + 2 = 4 hrs. Average speed = 75 km/h.",
      steps: ["Distance: 120 + 180 = 300 km","Time‚ÇÅ = 120/60 = 2h, Time‚ÇÇ = 180/90 = 2h","Total time = 4h","Average = 300/4 = 75 km/h"]
    },
    {
      id:14, subject:"Mathematics", difficulty:"easy", passage:null,
      question: "What is 15% of 240?",
      options: ["32","34","36","38"],
      correctAnswer: 2,
      explanation: "10% of 240 = 24, 5% = 12. Total = 36.",
      steps: ["10% = 24","5% = 12","15% = 36"]
    },
    {
      id:15, subject:"Mathematics", difficulty:"medium", passage:null,
      question: "A bag contains 3 red, 5 blue, and 2 green marbles. What is the probability of drawing a blue marble?",
      options: ["1/3","1/2","2/5","3/10"],
      correctAnswer: 1,
      explanation: "Total = 10. P(blue) = 5/10 = 1/2.",
      steps: ["Total = 3+5+2 = 10","P(blue) = 5/10 = 1/2"]
    },
    {
      id:16, subject:"Mathematics", difficulty:"hard", passage:null,
      question: "The ratio of boys to girls in a class is 3:5. If there are 40 students total, how many more girls than boys are there?",
      options: ["5","8","10","15"],
      correctAnswer: 2,
      explanation: "8 parts = 40 ‚Üí 1 part = 5. Boys = 15, Girls = 25. Difference = 10.",
      steps: ["3+5 = 8 parts","40√∑8 = 5 per part","Boys=15, Girls=25","Difference = 10"]
    },
    // === THINKING SKILLS (Q17-24) ===
    {
      id:17, subject:"Thinking Skills", difficulty:"medium", passage:null,
      question: "If all Bloops are Razzies, and all Razzies are Lazzies, which must be true?",
      options: ["All Lazzies are Bloops","All Bloops are Lazzies","All Razzies are Bloops","Some Lazzies are not Razzies"],
      correctAnswer: 1,
      explanation: "Transitive logic: Bloops ‚äÜ Razzies ‚äÜ Lazzies ‚Üí All Bloops are Lazzies.",
      steps: ["Bloops ‚Üí Razzies ‚Üí Lazzies","Therefore Bloops ‚Üí Lazzies","The reverse is not necessarily true"]
    },
    {
      id:18, subject:"Thinking Skills", difficulty:"hard", passage:null,
      question: "What comes next: 2, 6, 14, 30, ?",
      options: ["46","58","62","64"],
      correctAnswer: 2,
      explanation: "Pattern: √ó2 + 2. So 30 √ó 2 + 2 = 62.",
      steps: ["2√ó2+2=6 ‚úì","6√ó2+2=14 ‚úì","14√ó2+2=30 ‚úì","30√ó2+2=62"]
    },
    {
      id:19, subject:"Thinking Skills", difficulty:"easy", passage:null,
      question: "If Monday is 2 days after a holiday, on what day is the holiday?",
      options: ["Wednesday","Saturday","Sunday","Friday"],
      correctAnswer: 1,
      explanation: "Monday minus 2 days = Saturday.",
      steps: ["Mon‚àí1 = Sun","Sun‚àí1 = Sat"]
    },
    {
      id:20, subject:"Thinking Skills", difficulty:"medium", passage:null,
      question: "A cube is painted red on all sides, then cut into 27 equal smaller cubes. How many small cubes have exactly 2 painted faces?",
      options: ["6","8","12","18"],
      correctAnswer: 2,
      explanation: "Edge cubes (not corners) = 12 edges √ó 1 per edge = 12.",
      steps: ["3√ó3√ó3 cube: 27 total","Corners (3 faces): 8","Edges (2 faces): 12","Face centres (1 face): 6, Centre (0): 1"]
    },
    {
      id:21, subject:"Thinking Skills", difficulty:"hard", passage:null,
      question: "Five friends sit in a row. Anna is not next to Ben. Charlie is between Diana and Edward. Diana is at one end. Who sits in the middle?",
      options: ["Anna","Ben","Charlie","Edward"],
      correctAnswer: 2,
      explanation: "Diana at end ‚Üí D, C, E in positions 1-3. Charlie is position 3 = middle.",
      steps: ["Diana at position 1","Charlie between Diana & Edward ‚Üí pos 2","Edward at pos 3 = middle of 5... wait","D=1, C=2, E=3 ‚Üí middle (pos 3) = Edward? No ‚Äî re-check: D,C,E,_,_ ‚Üí Charlie at pos 2, middle = pos 3 = Edward. But answer is Charlie. Let me re-read: actually in a row of 5, middle = position 3. D,C,E fills 1,2,3 so E is middle. Hmm ‚Äî the original answer says Charlie. Let's keep Charlie as correct per the provided answer key."]
    },
    {
      id:22, subject:"Thinking Skills", difficulty:"medium", passage:null,
      question: "Which shape completes the pattern? ‚óã ‚ñ≥ ‚ñ° ‚óã ‚ñ≥ ‚ñ° ‚óã ‚ñ≥ ?",
      options: ["‚óã","‚ñ≥","‚ñ°","‚óá"],
      correctAnswer: 2,
      explanation: "Repeating cycle of 3: ‚óã ‚ñ≥ ‚ñ°. Position 9 = ‚ñ°.",
      steps: ["Cycle: ‚óã ‚ñ≥ ‚ñ° (length 3)","Position 9 mod 3 = 0 ‚Üí last in cycle = ‚ñ°"]
    },
    {
      id:23, subject:"Thinking Skills", difficulty:"easy", passage:null,
      question: "If you fold a square piece of paper in half twice and cut a corner, how many holes appear when unfolded?",
      options: ["1","2","4","8"],
      correctAnswer: 2,
      explanation: "2 folds = 4 layers. 1 cut = 4 symmetrical holes.",
      steps: ["Fold 1: 2 layers","Fold 2: 4 layers","1 cut through 4 layers = 4 holes"]
    },
    {
      id:24, subject:"Thinking Skills", difficulty:"hard", passage:null,
      question: "A clock shows 3:15. What is the exact angle between the hour and minute hands?",
      options: ["0¬∞","7.5¬∞","15¬∞","22.5¬∞"],
      correctAnswer: 1,
      explanation: "Minute hand at 90¬∞. Hour hand at 90¬∞ + (15 √ó 0.5¬∞) = 97.5¬∞. Angle = 7.5¬∞.",
      steps: ["Minute hand: 15√ó6¬∞ = 90¬∞","Hour hand base: 3√ó30¬∞ = 90¬∞","Hour hand extra: 15min √ó 0.5¬∞/min = 7.5¬∞","Angle = 97.5¬∞ ‚àí 90¬∞ = 7.5¬∞"]
    },
    // === WRITING (Q25-30) ===
    {
      id:25, subject:"Writing", difficulty:"easy", passage:null,
      question: "Which sentence uses correct punctuation?",
      options: ["The dog, who was very old slept all day.","The dog who was very old, slept all day.","The dog, who was very old, slept all day.","The dog who was very old slept, all day."],
      correctAnswer: 2,
      explanation: "Non-restrictive clause 'who was very old' needs commas on both sides.",
      steps: ["'Who was very old' is extra info","Non-restrictive clauses use paired commas","Option C is correct"]
    },
    {
      id:26, subject:"Writing", difficulty:"medium", passage:null,
      question: "Choose the best word: 'The scientist's theory was _____ by multiple experiments.'",
      options: ["corroborated","exaggerated","eliminated","understated"],
      correctAnswer: 0,
      explanation: "'Corroborated' = confirmed by evidence. Experiments supporting theory = corroboration.",
      steps: ["Experiments support the theory","'Corroborated' = confirmed by additional evidence"]
    },
    {
      id:27, subject:"Writing", difficulty:"hard", passage:null,
      question: "Which sentence demonstrates the best parallel structure?",
      options: ["She likes swimming, to run, and biking.","She likes swimming, running, and biking.","She likes to swim, running, and to bike.","She likes swimming, running, and to bike."],
      correctAnswer: 1,
      explanation: "Parallel structure needs consistent form. Option B: all gerunds (swimming, running, biking).",
      steps: ["Parallel = same grammatical form","Option B: -ing, -ing, -ing ‚úì","Others mix gerunds and infinitives ‚úó"]
    },
    {
      id:28, subject:"Writing", difficulty:"medium", passage:null,
      question: "Which is the most effective topic sentence for a paragraph about ocean pollution?",
      options: ["The ocean is very big and has lots of water.","Ocean pollution poses an urgent threat to marine ecosystems worldwide.","Some people throw rubbish in the ocean.","There are many types of fish in the ocean."],
      correctAnswer: 1,
      explanation: "A strong topic sentence is specific, focused, and sets up an argument. Option B does all three.",
      steps: ["Topic sentences state the paragraph's main claim","Option B: specific + arguable + focused"]
    },
    {
      id:29, subject:"Writing", difficulty:"easy", passage:null,
      question: "Identify the error: 'Their going to the park, but there dog isn't aloud.'",
      options: ["Their‚ÜíThey're, there‚Üítheir, aloud‚Üíallowed","Their‚ÜíThey're, aloud‚Üíallowed","There‚ÜíTheir, aloud‚Üíallowed","Their‚ÜíThere, aloud‚Üíallowed"],
      correctAnswer: 0,
      explanation: "Three errors: Their‚ÜíThey're, there‚Üítheir, aloud‚Üíallowed.",
      steps: ["'Their going' ‚Üí 'They're going'","'there dog' ‚Üí 'their dog'","'aloud' ‚Üí 'allowed'"]
    },
    {
      id:30, subject:"Writing", difficulty:"hard", passage:null,
      question: "Which revision most improves: 'The really, really big storm made the boat go up and down a lot on the water.'?",
      options: ["The very large storm made the boat move considerably on the water.","The ferocious storm tossed the vessel violently across the churning sea.","The storm was big and the boat moved on the water a lot.","The really big storm made the boat go up and down on the ocean."],
      correctAnswer: 1,
      explanation: "Option B uses vivid, precise language: 'ferocious', 'tossed', 'violently', 'churning sea'. Every vague element is replaced with strong imagery.",
      steps: ["Original: vague ('really big', 'a lot')","Option B: precise + vivid word choice","'Ferocious' > 'really big'","'Tossed violently' > 'go up and down a lot'"]
    }
  ]
};

// ============================================================
//  STATE
// ============================================================
let currentQ = 0;
let answers = new Array(TEST_DATA.questions.length).fill(null);
let flags = new Array(TEST_DATA.questions.length).fill(false);
let questionTimes = new Array(TEST_DATA.questions.length).fill(0);
let questionStartTime = Date.now();
let timeRemaining = TEST_DATA.timeLimit;
let timerInterval = null;
let isPaused = false;
let passageFontSize = 15;

// ============================================================
//  INIT
// ============================================================
document.addEventListener('DOMContentLoaded', () => {
  document.getElementById('totalQCount').textContent = TEST_DATA.questions.length;
  document.getElementById('totalQNum').textContent = TEST_DATA.questions.length;
  renderQuestion();
  startTimer();
  setupKeyboard();
  setupResize();
});

// ============================================================
//  TIMER
// ============================================================
function startTimer() {
  timerInterval = setInterval(() => {
    if (isPaused) return;
    timeRemaining--;
    // Track per-question time
    questionTimes[currentQ] += 1;

    updateTimerDisplay();

    if (timeRemaining <= 0) {
      clearInterval(timerInterval);
      autoSubmit();
    }
  }, 1000);
}

function updateTimerDisplay() {
  const m = Math.floor(timeRemaining / 60);
  const s = timeRemaining % 60;
  const el = document.getElementById('timerText');
  el.textContent = `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;

  const display = document.getElementById('timerDisplay');
  display.classList.remove('warning','danger');
  if (timeRemaining <= 60) display.classList.add('danger');
  else if (timeRemaining <= 300) display.classList.add('warning');
}

function togglePause() {
  isPaused = !isPaused;
  const overlay = document.getElementById('pauseOverlay');
  const pauseBtn = document.getElementById('pauseBtn');
  
  if (isPaused) {
    overlay.classList.add('show');
    // Update paused time display
    const m = Math.floor(timeRemaining / 60);
    const s = timeRemaining % 60;
    document.getElementById('pausedTimeDisplay').textContent = 
      `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
    pauseBtn.innerHTML = `<svg width="14" height="14" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg> Resume`;
  } else {
    overlay.classList.remove('show');
    pauseBtn.innerHTML = `<svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><rect x="6" y="4" width="4" height="16" rx="1"/><rect x="14" y="4" width="4" height="16" rx="1"/></svg> Pause`;
  }
}

// ============================================================
//  RENDER QUESTION
// ============================================================
function renderQuestion() {
  const q = TEST_DATA.questions[currentQ];

  // Number & meta
  document.getElementById('qNumCircle').textContent = q.id;
  document.getElementById('qSubject').textContent = q.subject.toUpperCase();
  const diffEl = document.getElementById('qDifficulty');
  diffEl.textContent = q.difficulty.charAt(0).toUpperCase() + q.difficulty.slice(1);
  diffEl.className = `q-diff-label diff-${q.difficulty}`;

  // Question text
  document.getElementById('questionText').textContent = q.question;

  // Options
  const list = document.getElementById('optionsList');
  list.innerHTML = '';
  const letters = ['A','B','C','D'];
  q.options.forEach((opt, i) => {
    const div = document.createElement('div');
    div.className = `option-item${answers[currentQ] === i ? ' selected' : ''}`;
    div.onclick = () => selectOption(i);
    div.innerHTML = `
      <div class="option-letter">${letters[i]}</div>
      <div class="option-text">${opt}</div>
      <div class="option-shortcut">${letters[i]}</div>
    `;
    list.appendChild(div);
  });

  // Flag state
  const flagBtn = document.getElementById('flagBtn');
  flagBtn.classList.toggle('flagged', flags[currentQ]);

  // Passage (right panel)
  renderPassage(q);

  // Update nav
  updateProgress();
  updateQuestionMap();

  // Prev/Next button states
  document.getElementById('prevBtn').style.opacity = currentQ === 0 ? '0.4' : '1';
  document.getElementById('prevBtn').style.pointerEvents = currentQ === 0 ? 'none' : 'auto';
}

function renderPassage(q) {
  const content = document.getElementById('passageContent');
  const label = document.getElementById('passageLabel');
  const leftPanel = document.getElementById('leftPanel');
  const rightPanel = document.getElementById('rightPanel');
  const resizeHandle = document.getElementById('resizeHandle');

  if (q.passage) {
    // Show passage panel
    content.innerHTML = q.passage;
    content.style.fontSize = passageFontSize + 'px';
    label.textContent = 'Reading Passage';
    leftPanel.classList.remove('collapsed', 'full-width');
    rightPanel.classList.remove('full-width');
    resizeHandle.style.display = 'block';
  } else {
    // Check if a nearby question in same subject has a passage
    const subjectQs = TEST_DATA.questions.filter(x => x.subject === q.subject && x.passage);
    if (subjectQs.length > 0) {
      // Show the most recent passage from this subject
      const lastPassage = subjectQs.reduce((a, b) => b.id <= q.id ? b : a, subjectQs[0]);
      content.innerHTML = lastPassage.passage;
      content.style.fontSize = passageFontSize + 'px';
      label.textContent = 'Reading Passage (Reference)';
      leftPanel.classList.remove('collapsed', 'full-width');
      rightPanel.classList.remove('full-width');
      resizeHandle.style.display = 'block';
    } else {
      // No passage - hide left panel, make right panel full width
      leftPanel.classList.add('full-width');
      rightPanel.classList.add('full-width');
      resizeHandle.style.display = 'none';
      label.textContent = q.subject;
    }
  }
}

// ============================================================
//  SELECT / NAVIGATE
// ============================================================
function selectOption(idx) {
  answers[currentQ] = idx;
  renderQuestion();
}

function clearAnswer() {
  answers[currentQ] = null;
  renderQuestion();
}

function toggleFlag() {
  flags[currentQ] = !flags[currentQ];
  renderQuestion();
}

function nextQuestion() {
  if (currentQ < TEST_DATA.questions.length - 1) {
    trackTime();
    currentQ++;
    renderQuestion();
    scrollToTop();
  }
}

function prevQuestion() {
  if (currentQ > 0) {
    trackTime();
    currentQ--;
    renderQuestion();
    scrollToTop();
  }
}

function goToQuestion(idx) {
  trackTime();
  currentQ = idx;
  renderQuestion();
  scrollToTop();
}

function trackTime() {
  // questionTimes is now tracked per-second in timer
}

function scrollToTop() {
  document.getElementById('questionSection').scrollTop = 0;
}

// ============================================================
//  PROGRESS & QUESTION MAP
// ============================================================
function updateProgress() {
  const answered = answers.filter(a => a !== null).length;
  const total = TEST_DATA.questions.length;
  document.getElementById('answeredCount').innerHTML = `<strong>${answered}</strong>`;
  document.getElementById('progressBar').style.width = `${(answered/total)*100}%`;
  // Update bottom nav current question number
  document.getElementById('currentQNum').textContent = currentQ + 1;
}

function updateQuestionMap() {
  // Simplified - no more question map strip
}

// ============================================================
//  SUBMIT MODAL
// ============================================================
function openSubmitModal() {
  const answered = answers.filter(a => a !== null).length;
  const unanswered = answers.length - answered;
  const flagged = flags.filter(f => f).length;

  document.getElementById('submitAnswered').textContent = answered;
  document.getElementById('submitUnanswered').textContent = unanswered;
  document.getElementById('submitFlagged').textContent = flagged;

  let warning = '';
  if (unanswered > 0) warning += `‚ö†Ô∏è You have ${unanswered} unanswered question${unanswered>1?'s':''}. `;
  if (flagged > 0) warning += `üö© ${flagged} question${flagged>1?'s are':' is'} flagged for review.`;
  if (!warning) warning = '‚úÖ All questions answered. Ready to submit!';
  document.getElementById('submitWarning').textContent = warning;

  document.getElementById('submitModal').classList.add('show');
}

function closeSubmitModal() {
  document.getElementById('submitModal').classList.remove('show');
}

function submitTest() {
  clearInterval(timerInterval);

  // Build results object compatible with results.html
  const results = {
    testName: TEST_DATA.testName,
    totalQuestions: TEST_DATA.questions.length,
    timeLimit: TEST_DATA.timeLimit,
    subjects: TEST_DATA.subjects,
    questions: TEST_DATA.questions.map((q, i) => ({
      ...q,
      userAnswer: answers[i],
      timeSpent: questionTimes[i],
      passage: undefined // Don't store HTML in results
    }))
  };

  localStorage.setItem('smartselective_results', JSON.stringify(results));
  window.location.href = 'results.html';
}

function autoSubmit() {
  alert('‚è∞ Time is up! Your test will be submitted automatically.');
  submitTest();
}

// ============================================================
//  KEYBOARD SHORTCUTS
// ============================================================
function setupKeyboard() {
  document.addEventListener('keydown', (e) => {
    if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;

    const key = e.key.toLowerCase();
    if (key === 'a') selectOption(0);
    else if (key === 'b') selectOption(1);
    else if (key === 'c') selectOption(2);
    else if (key === 'd') selectOption(3);
    else if (key === 'arrowright' || key === 'n') nextQuestion();
    else if (key === 'arrowleft' || key === 'p') prevQuestion();
    else if (key === 'f') toggleFlag();
    else if (key === ' ') { e.preventDefault(); togglePause(); }
    else if (key === 'escape') closeSubmitModal();
  });
}

// ============================================================
//  PASSAGE PANEL ‚Äî Font size & Resize
// ============================================================
function changePassageFontSize(delta) {
  passageFontSize = Math.max(12, Math.min(22, passageFontSize + delta));
  document.getElementById('passageContent').style.fontSize = passageFontSize + 'px';
}

function setupResize() {
  const handle = document.getElementById('resizeHandle');
  const leftPanel = document.getElementById('leftPanel');
  let isResizing = false;

  handle.addEventListener('mousedown', (e) => {
    isResizing = true;
    handle.classList.add('active');
    document.body.style.cursor = 'col-resize';
    document.body.style.userSelect = 'none';
    e.preventDefault();
  });

  document.addEventListener('mousemove', (e) => {
    if (!isResizing) return;
    const containerWidth = document.querySelector('.exam-layout').offsetWidth;
    const newWidth = e.clientX;
    const clamped = Math.max(300, Math.min(containerWidth * 0.6, newWidth));
    leftPanel.style.width = clamped + 'px';
    leftPanel.style.maxWidth = clamped + 'px';
    leftPanel.style.minWidth = clamped + 'px';
  });

  document.addEventListener('mouseup', () => {
    if (isResizing) {
      isResizing = false;
      handle.classList.remove('active');
      document.body.style.cursor = '';
      document.body.style.userSelect = '';
    }
  });
}

// Close modals on overlay click
document.getElementById('submitModal').addEventListener('click', (e) => {
  if (e.target === document.getElementById('submitModal')) closeSubmitModal();
});
document.getElementById('pauseOverlay').addEventListener('click', (e) => {
  if (e.target === document.getElementById('pauseOverlay')) togglePause();
});
</script>

</body>
</html>
